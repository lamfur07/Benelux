---
import { getCollection } from 'astro:content';
import Layout from '@/layouts/Layout.astro';
import BlurDots from '@/components/common/BlurDots.astro';
import Hero from '@/components/sections/home/Hero.astro';
import Services from '@/components/sections/home/Services.astro';
import Process from '@/components/sections/home/Process.astro';
import Projects from '@/components/sections/home/Projects.astro';
import Testimonials from '@/components/sections/home/Testimonials.astro';
import CTABanner from '@/components/common/CTABanner.astro';
import { t } from '@/lib/utils';

const projects = await getCollection('projects');
const projectFilter = projects.sort((a, b) => b.data.yearFinished - a.data.yearFinished).slice(0, 3);
---

<Layout title={t('meta.index.title')} description={t('meta.index.description')} keywords={t('meta.index.keywords')}>
  <div class="hero-container">
    <BlurDots />
    <Hero />
  </div>
  <div class="content-wrapper border-t-accent rounded-t-2xl border">
    <Services />
    <Process />
    <Projects projects={projectFilter} />
    <Testimonials />
    <CTABanner />
  </div>
</Layout>

<style>
  .hero-container {
    position: sticky;
    top: 0;
    height: 100vh;
    z-index: 1;
    transition: transform 0.3s ease-out;
  }

  .content-wrapper {
    position: relative;
    z-index: 10;
    background: var(--color-primary, #0f172a);
    border-radius: 30px 30px 0 0;
  }
</style>

<script>
  const heroContainer = document.querySelector('.hero-container');

  if (heroContainer) {
    let ticking = false;

    const updateHeroEffect = () => {
      const scrollY = window.scrollY;
      const heroHeight = window.innerHeight;

      const progress = Math.min(scrollY / (heroHeight * 0.5), 1);

      const scale = 1 - progress * 0.2;

      (heroContainer as HTMLElement).style.transform = `scale(${scale})`;

      ticking = false;
    };

    const onScroll = () => {
      if (!ticking) {
        window.requestAnimationFrame(updateHeroEffect);
        ticking = true;
      }
    };

    window.addEventListener('scroll', onScroll, { passive: true });
    updateHeroEffect();
  }
</script>
