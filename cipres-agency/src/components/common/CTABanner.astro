---
import { t } from '@/lib/utils';
import Button from '@/components/ui/buttons/Button.astro';

interface Props {
  title?: string;
  description?: string;
  buttonText?: string;
  buttonHref?: string;
}

const {
  title = t('cta.title'),
  description = t('cta.description'),
  buttonText = t('cta.button'),
  buttonHref = '/contact',
} = Astro.props;

const titleWords = title.split(' ');
---

<section id="cta-banner" class="cta-section overflow-hidden rounded-3xl px-6 py-16 md:px-16 md:py-24 lg:px-20">
  <div class="mx-auto grid max-w-7xl items-center gap-12 md:grid-cols-2 lg:gap-16">
    <div>
      <h2 class="font-anton-sc text-accent flex flex-wrap gap-x-4 text-5xl tracking-tight md:text-6xl lg:text-9xl">
        {titleWords.map((word) => <span class="cta-word inline-block translate-y-16 opacity-0">{word}</span>)}
      </h2>
    </div>

    <div class="flex flex-col gap-6">
      <p
        class="font-space-grotesk cta-description text-muted leading-relaxed opacity-0 text-lg lg:text-xl"
      >
        {description}
      </p>

      <div class="cta-button translate-y-8 opacity-0 md:text-center">
        <Button href={buttonHref} variant="primary">
          {buttonText}
        </Button>
      </div>
    </div>
  </div>
</section>

<script>
  import gsap from 'gsap';

  function setupCTAAnimation() {
    function animateCTA() {
      const tl = gsap.timeline({
        defaults: { ease: 'power3.out' },
      });

      tl.to('.cta-word', {
        y: 0,
        opacity: 1,
        duration: 0.9,
        stagger: 0.1,
      })
        .to(
          '.cta-description',
          {
            y: 0,
            opacity: 1,
            duration: 0.7,
          },
          '-=0.4',
        )
        .to(
          '.cta-button',
          {
            y: 0,
            opacity: 1,
            duration: 0.6,
          },
          '-=0.3',
        );
    }

    const ctaSection = document.querySelector('.cta-section');

    if (ctaSection) {
      const observer = new IntersectionObserver(
        (entries) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              animateCTA();
              observer.unobserve(entry.target);
            }
          });
        },
        {
          threshold: 0.3,
          rootMargin: '0px',
        },
      );

      observer.observe(ctaSection);
    }
  }

  // Ejecutar al cargar la página
  setupCTAAnimation();

  // Ejecutar después de cada transición de View Transitions
  document.addEventListener('astro:page-load', setupCTAAnimation);
</script>
