---
import { Image } from 'astro:assets';
import { FullscreenMenu } from './FullscreenMenu';
import Button from '@/components/ui/buttons/Button.astro';
import logo from '@/assets/tni-professionals-logo-cream-outline.webp';

---

<nav id="navbar" class="fixed top-0 left-0 z-50 flex w-full items-center justify-between px-4 py-6 md:px-12 md:py-9">
  <!-- Logo -->
  <a href="/" class="pointer-events-auto transition-transform duration-300 hover:scale-105">
    <Image src={logo} alt="TNI Professionals Logo" class="h-auto w-48" />
  </a>

  <!-- Right Side Buttons -->
  <div class="pointer-events-auto flex items-center gap-0">
    <!-- Let's Talk Button -->
    <Button href="/contact" variant="primary" size="md" class="hidden px-6 py-2 md:block md:px-8 md:py-3">
      Let's Talk
    </Button>

    <!-- Menu Button -->
    <Button
      id="menu-toggle"
      variant="secondary"
      aria-label="Toggle menu"
      class="flex h-10 w-10 flex-col items-center justify-center gap-1.5 rounded-full md:h-12 md:w-12"
    >
      <span class="h-0.5 w-5 bg-current transition-all duration-300 group-hover:bg-white md:w-6"></span>
      <span class="h-0.5 w-5 bg-current transition-all duration-300 group-hover:bg-white md:w-6"></span>
    </Button>
  </div>
</nav>

<!-- Fullscreen Menu -->
<FullscreenMenu client:load />

<script>
  function setupMenu() {
    const menuToggle = document.getElementById('menu-toggle');
    let isMenuOpen = false;

    // Menu toggle
    menuToggle?.addEventListener('click', () => {
      isMenuOpen = !isMenuOpen;

      // Dispatch custom event to React component
      window.dispatchEvent(new CustomEvent('toggleMenu', { detail: { isOpen: isMenuOpen } }));
    });

    // Listen for menu close from React
    const handleCloseMenu = () => {
      isMenuOpen = false;
    };

    window.addEventListener('closeMenu', handleCloseMenu);
  }

  // Ejecutar al cargar la página
  setupMenu();

  // Ejecutar después de cada transición de View Transitions
  document.addEventListener('astro:page-load', setupMenu);
</script>
